From cda3f57a9928ae6ee0870d9543829d864d9e15c9 Mon Sep 17 00:00:00 2001
From: Mario Limonciello <mario.limonciello@dell.com>
Date: Wed, 1 Apr 2020 13:09:52 -0500
Subject: [PATCH] trivial: fix self tests for empty `/etc/machine-id` (LP:
 #1870051)

This ports the fix https://github.com/hughsie/libjcat/commit/6ac46df8e754006b0e8900e16a8ee6412a8d7360
from libjcat to fwupd 1_3_X.  master is not affected.
---
 src/fu-self-test.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/fu-self-test.c b/src/fu-self-test.c
index 9438e187..db8bdcd5 100644
--- a/src/fu-self-test.c
+++ b/src/fu-self-test.c
@@ -2708,6 +2708,7 @@ static void
 fu_keyring_pkcs7_self_signed_func (gconstpointer user_data)
 {
 #ifdef ENABLE_PKCS7
+	static const gchar payload_str[] = "Hello, world!";
 	gboolean ret;
 	g_autoptr(FuKeyring) kr = NULL;
 	g_autoptr(FuKeyringResult) kr_result = NULL;
@@ -2726,8 +2727,7 @@ fu_keyring_pkcs7_self_signed_func (gconstpointer user_data)
 	ret = fu_keyring_setup (kr, &error);
 	g_assert_no_error (error);
 	g_assert_true (ret);
-	payload = fu_common_get_contents_bytes ("/etc/machine-id", &error);
-	g_assert_no_error (error);
+	payload = g_bytes_new_static (payload_str, sizeof (payload_str));
 	g_assert_nonnull (payload);
 	signature = fu_keyring_sign_data (kr, payload, FU_KEYRING_SIGN_FLAG_ADD_TIMESTAMP, &error);
 	g_assert_no_error (error);
-- 
2.25.1

